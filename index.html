<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Examen Interactivo — Banco 100 → 30 preguntas (Cabeza y Cuello)</title>
<style>
  :root{
    --bg:#f7f7f7; --card:#fff; --primary:#0066ff; --muted:#666;
    --ok-bg:#e6ffed; --ok-border:#9de6b8; --bad-bg:#ffe6e6; --bad-border:#ff9d9d;
  }
  body{font-family:Inter,system-ui,Arial; background:var(--bg); margin:0; padding:24px; display:flex; justify-content:center;}
  .wrap{width:100%; max-width:1100px;}
  .container{background:var(--card); border-radius:12px; padding:20px 24px; box-shadow:0 6px 30px rgba(0,0,0,0.08);}
  h1{margin:0 0 6px; font-size:20px;}
  p.lead{color:var(--muted); margin:4px 0 12px;}
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px;}
  button{background:var(--primary); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;}
  button.secondary{background:#888;}
  .exam{margin-top:10px;}
  .question{border:1px solid #e6e6e6; padding:14px; border-radius:10px; margin-bottom:12px; background:#fafafa;}
  .question h3{margin:0 0 8px; font-size:16px;}
  .options label{display:block; margin:6px 0; cursor:pointer;}
  .badge{display:inline-block; padding:4px 8px; border-radius:6px; font-weight:600; margin-right:8px;}
  .badge.ok{color:#0a6d2f;}
  .badge.bad{color:#8b0000;}
  .explain{margin-top:10px; padding:10px; border-radius:8px; background:#fbfbfb; font-size:14px; color:#222; border-left:4px solid rgba(0,0,0,0.06);}
  .correct{background:var(--ok-bg); border-color:var(--ok-border);}
  .incorrect{background:var(--bad-bg); border-color:var(--bad-border);}
  #result{margin-top:12px; padding:14px; border-radius:10px; background:#eef7ff; border-left:6px solid var(--primary);}
  .small{font-size:13px; color:var(--muted);}
  @media(min-width:900px){ .controls{justify-content:flex-start;} }
</style>
</head>
<body>
<div class="wrap">
  <div class="container">
    <h1>Examen Interactivo — Cabeza y Cuello (Banco 100 → 30)</h1>
    <p class="lead">Cada intento genera 30 preguntas aleatorias (sin temporizador). Las opciones también se mezclan. Al finalizar verás explicación de las preguntas incorrectas.</p>

    <div class="controls">
      <button id="startBtn">Iniciar examen</button>
      <button id="finishBtn" class="hidden secondary">Finalizar examen</button>
      <button id="retryBtn" class="hidden secondary">Reintentar</button>
      <div style="flex:1"></div>
      <div class="small">Fuente: Resumen de "Cabeza y Cuello" (documento provisto)</div>
    </div>

    <div id="exam" class="exam hidden"></div>
    <div id="result" class="hidden"></div>
  </div>
</div>

<script>
/* ===== BANCO DE 100 PREGUNTAS (basadas en el documento provisto) =====
   Cada elemento: { question, options:[4], answer: index (0..3), explanation }
   NOTA: las explicaciones son concisas y tomadas directamente del texto suministrado. */
const questionBank = [
  { question: "¿Cómo se llama el protagonista de 'Naruto'?", options: ["Naruto Uzumaki","Sasuke Uchiha","Kakashi Hatake","Minato Namikaze"], answer:0, explanation: "Naruto Uzumaki es el personaje principal de la serie." },
  { question: "¿Cuál es el nombre del demonio dentro de Naruto?", options: ["Shukaku","Kurama","Gyūki","Matatabi"], answer:1, explanation: "Kurama es el Zorro de Nueve Colas sellado dentro de Naruto." },
  { question: "¿En qué anime aparece la organización 'Akatsuki'?", options: ["Bleach","One Piece","Naruto","Fairy Tail"], answer:2, explanation: "Akatsuki es una organización criminal de 'Naruto'." },
  { question: "¿Cuál es el tesoro más buscado en 'One Piece'?", options: ["Eternal Pose","Road Poneglyph","One Piece","Davy Back Fight"], answer:2, explanation: "El One Piece es el tesoro legendario buscado por los piratas." },
  { question: "¿Quién es el capitán de los Piratas del Sombrero de Paja?", options: ["Zoro","Sanji","Usopp","Luffy"], answer:3, explanation: "Monkey D. Luffy es el capitán." },
  { question: "¿Qué fruta del diablo comió Luffy?", options: ["Gomu Gomu no Mi","Mera Mera no Mi","Hito Hito no Mi","Yami Yami no Mi"], answer:0, explanation: "La Gomu Gomu no Mi vuelve el cuerpo de goma." },
  { question: "¿En 'Dragon Ball Z', quién es el príncipe de los Saiyajin?", options: ["Goku","Vegeta","Nappa","Raditz"], answer:1, explanation: "Vegeta es el príncipe de los Saiyajin." },
  { question: "¿Cómo se llama la forma más icónica de Goku?", options: ["Super Saiyajin","Ultra Instinto","Kaioken","Gran Simio"], answer:0, explanation: "El Super Saiyajin es su transformación más conocida." },
  { question: "¿Quién es el Shinigami que acompaña a Light Yagami en 'Death Note'?", options: ["Rem","Ryuk","Sidoh","Gelus"], answer:1, explanation: "Ryuk es el Shinigami que deja caer la Death Note." },
  { question: "¿Cuál es el verdadero nombre de L en 'Death Note'?", options: ["Lawliet","Leonard","Lucius","Lance"], answer:0, explanation: "L se llama L Lawliet." },

  { question: "¿En qué anime aparece el 'Sharingan'?", options: ["Naruto","Bleach","Tokyo Ghoul","Black Clover"], answer:0, explanation: "El Sharingan es un dōjutsu del Clan Uchiha en Naruto." },
  { question: "¿Cuál es la ghoul protagonista femenina de Tokyo Ghoul?", options: ["Touka","Rize","Hinami","Eto"], answer:0, explanation: "Touka Kirishima es una de las protagonistas." },
  { question: "¿Qué tipo de ser es Kaneki tras su operación?", options: ["Humano","Ghoul","Mitad ghoul","Investigador"], answer:2, explanation: "Kaneki queda convertido en un híbrido mitad ghoul." },
  { question: "¿Cómo se llama el protagonista de 'Fullmetal Alchemist'?", options: ["Alphonse","Mustang","Edward","Scar"], answer:2, explanation: "Edward Elric es el protagonista." },
  { question: "¿Qué buscan los hermanos Elric?", options: ["La piedra filosofal","Un grimorio","Una esfera del dragón","La caja de Pandora"], answer:0, explanation: "Buscan la piedra filosofal para recuperar sus cuerpos." },
  { question: "¿En qué anime existe el 'Banco de Almas'?", options: ["Bleach","Naruto","One Piece","Jujutsu Kaisen"], answer:0, explanation: "Es un concepto de Bleach." },
  { question: "¿Cómo se llaman las espadas de los Shinigamis en Bleach?", options: ["Zanpakutō","Kusanagi","Nichirin","Sephira"], answer:0, explanation: "Las Zanpakutō son las armas distintivas de los Shinigami." },
  { question: "¿En 'Attack on Titan', quién es el protagonista?", options: ["Armin","Levi","Eren","Reiner"], answer:2, explanation: "Eren Yeager es el protagonista." },
  { question: "¿Cómo se llaman las criaturas principales de Attack on Titan?", options: ["Titans","Hollows","Gigants","Kaiju"], answer:0, explanation: "Los Titanes son las criaturas principales." },
  { question: "¿Qué arma usan para moverse los soldados en Attack on Titan?", options: ["Jetpack","ODM Gear","Hook Blade","Grapple Boots"], answer:1, explanation: "El Equipo de Maniobras Tridimensionales (ODM) es su equipo de combate." },

  { question: "¿Cómo se llama el protagonista de 'Demon Slayer'?", options: ["Zenitsu","Inosuke","Tanjiro","Giyu"], answer:2, explanation: "Tanjiro Kamado es el protagonista." },
  { question: "¿Qué tipo de arma usan los cazadores en Demon Slayer?", options: ["Zanpakuto","Nichirin","Muramasa","Katanas elementales"], answer:1, explanation: "Las espadas Nichirin cambian de color según su usuario." },
  { question: "¿Quién es la hermana de Tanjiro?", options: ["Kanae","Mitsuri","Kanao","Nezuko"], answer:3, explanation: "Nezuko fue convertida en demonio." },
  { question: "¿Quién es el protagonista de Jujutsu Kaisen?", options: ["Sukuna","Megumi","Yuji","Gojo"], answer:2, explanation: "Yuji Itadori es el protagonista." },
  { question: "¿Quién es el hechicero más fuerte de Jujutsu Kaisen?", options: ["Nanami","Gojo","Yuta","Geto"], answer:1, explanation: "Gojo Satoru es conocido como el más fuerte." },
  { question: "¿Cómo se llama el protagonista de Mob Psycho 100?", options: ["Mob","Reigen","Teru","Ritsu"], answer:0, explanation: "Su nombre real es Shigeo Kageyama, pero lo llaman Mob." },
  { question: "¿En qué anime aparece un arma llamada 'Scissor Blade'?", options: ["Kill la Kill","Soul Eater","Bleach","Fairy Tail"], answer:0, explanation: "La Scissor Blade es usada por Ryuko Matoi." },
  { question: "¿Cómo se llama el gremio protagonista de Fairy Tail?", options: ["Blue Pegasus","Fairy Tail","Sabertooth","Lamiascale"], answer:1, explanation: "El anime gira en torno al gremio Fairy Tail." },
  { question: "¿Quién es el protagonista de Fairy Tail?", options: ["Natsu","Gray","Laxus","Gajeel"], answer:0, explanation: "Natsu Dragneel es el protagonista." },
  { question: "¿Cómo se llama el dragón que crió a Natsu?", options: ["Igneel","Acnologia","Grandeeney","Metalicana"], answer:0, explanation: "Igneel es el dragón de fuego que crió a Natsu." },

  { question: "¿En qué anime aparece 'Greed Island'?", options: ["Hunter x Hunter","One Piece","SAO","Fairy Tail"], answer:0, explanation: "Greed Island es un arco de Hunter x Hunter." },
  { question: "¿Cómo se llama el mejor amigo de Gon?", options: ["Killua","Leorio","Kurapika","Hisoka"], answer:0, explanation: "Killua es el mejor amigo de Gon." },
  { question: "¿Qué arma usa Kurapika?", options: ["Katana","Cadenas","Lanza","Ballesta"], answer:1, explanation: "Kurapika utiliza cadenas con técnicas especiales." },
  { question: "¿Cómo se llama el protagonista de My Hero Academia?", options: ["Bakugo","Midoriya","Todoroki","Iida"], answer:1, explanation: "Izuku Midoriya (Deku) es el protagonista." },
  { question: "¿Cuál es el poder de All Might?", options: ["Explosion","One For All","Zero Gravity","Engine"], answer:1, explanation: "All Might posee One For All." },
  { question: "¿En qué anime los personajes usan grimorios mágicos?", options: ["Black Clover","Naruto","Bleach","Fairy Tail"], answer:0, explanation: "Los magos de Black Clover usan grimorios." },
  { question: "¿Quién es el protagonista de Black Clover?", options: ["Yuno","Asta","Finral","Luck"], answer:1, explanation: "Asta es el protagonista." },
  { question: "¿Qué le falta a Asta al inicio de la serie?", options: ["Magia","Fuerza","Memoria","Visión"], answer:0, explanation: "Asta nace sin magia en un mundo lleno de magos." },
  { question: "¿Cómo se llama el monstruo protagonista de Pokémon?", options: ["Squirtle","Pikachu","Eevee","Charizard"], answer:1, explanation: "Pikachu acompaña a Ash." },
  { question: "¿Quién es el protagonista de Pokémon?", options: ["Red","Blue","Ash","Gary"], answer:2, explanation: "Ash Ketchum es el protagonista del anime clásico." },

  { question: "¿Cómo se llama el protagonista de 'Sword Art Online'?", options: ["Klein","Kirito","Agil","Eugeo"], answer:1, explanation: "Kirito es el nombre del jugador." },
  { question: "¿Qué tipo de juego atrapa a los jugadores en SAO?", options: ["MMORPG","FPS","MOBA","Plataformas"], answer:0, explanation: "SAO es un MMORPG de realidad virtual." },
  { question: "¿Cómo se llama la protagonista femenina de SAO?", options: ["Sinon","Leafa","Asuna","Alice"], answer:2, explanation: "Asuna es la heroína principal." },
  { question: "¿Qué son los hollows en Bleach?", options: ["Monstruos espirituales","Demonios","Humanos modificados","Clones"], answer:0, explanation: "Los hollows son espíritus corruptos." },
  { question: "¿Cómo se llama el protagonista de Bleach?", options: ["Chad","Ishida","Ichigo","Renji"], answer:2, explanation: "Ichigo Kurosaki es el protagonista." },
  { question: "¿Qué miembro de Akatsuki usa marionetas?", options: ["Itachi","Deidara","Sasori","Tobi"], answer:2, explanation: "Sasori es el maestro de las marionetas." },
  { question: "¿Qué anime se centra en cazadores de demonios con armas llamadas 'Soul Weapons'?", options: ["Demon Slayer","Soul Eater","Black Clover","Fire Force"], answer:1, explanation: "Soul Eater trata sobre meisters y armas demoníacas." },
  { question: "¿Quién es el protagonista de Soul Eater?", options: ["Black☆Star","Kid","Maka","Crona"], answer:2, explanation: "Maka Albarn es la protagonista principal." },
  { question: "¿En qué anime aparecen las 'Esferas del Dragón'?", options: ["One Piece","Yu Yu Hakusho","Dragon Ball","Inuyasha"], answer:2, explanation: "Dragon Ball gira en torno a estas esferas mágicas." },
  { question: "¿Cuál es el deseo más famoso pedido al dragón Shenlong?", options: ["Inmortalidad","Un novio","Revivir a alguien","Ser rico"], answer:2, explanation: "Revivir personas es una petición recurrente." },

  { question: "¿Qué arma usa Inuyasha?", options: ["Tessaiga","Zanpakuto","Nichirin","Excalibur"], answer:0, explanation: "Inuyasha usa la espada Tessaiga." },
  { question: "¿Cómo se llama la chica que viaja al pasado en Inuyasha?", options: ["Kikyo","Sango","Rin","Kagome"], answer:3, explanation: "Kagome viaja al Japón feudal." },
  { question: "¿Cómo se llaman los espíritus que posee Yugi en Yu-Gi-Oh?", options: ["Faraones","Ka","Duendes","Hollows"], answer:1, explanation: "Los Ka son espíritus asociados a monstruos." },
  { question: "¿Cuál es el monstruo insignia de Yugi?", options: ["Dragón Blanco","Mago Oscuro","Slifer","Exodia"], answer:1, explanation: "El Mago Oscuro es su carta insignia." },
  { question: "¿Quién es el protagonista de Neon Genesis Evangelion?", options: ["Rei","Shinji","Kaworu","Asuka"], answer:1, explanation: "Shinji Ikari es el protagonista." },
  { question: "¿Qué son los Evas en Evangelion?", options: ["Robots","Ángeles","Mechas biológicos","Armas nucleares"], answer:2, explanation: "Los Evas son mechas orgánico-biológicos." },
  { question: "¿En qué anime aparece el gremio de asesinos llamado 'Night Raid'?", options: ["Akame ga Kill","Fate/Stay Night","Bleach","SAO"], answer:0, explanation: "Night Raid pertenece a Akame ga Kill." },
  { question: "¿Quién es la protagonista de Akame ga Kill?", options: ["Esdeath","Mine","Akame","Leone"], answer:2, explanation: "Akame es la asesina principal." },
  { question: "¿Cómo se llama el protagonista de Cowboy Bebop?", options: ["Jet","Vicious","Spike","Ed"], answer:2, explanation: "Spike Spiegel es el protagonista." },
  { question: "¿Cómo se llama la nave de Spike?", options: ["Swordfish II","Red Tail","Bebop","Hammerhead"], answer:0, explanation: "Swordfish II es su nave personal." },

  { question: "¿En qué anime los personajes mueren y reviven en un juego?", options: ["SAO","Gantz","Overlord","No Game No Life"], answer:1, explanation: "En Gantz los muertos participan en juegos mortales." },
  { question: "¿Cómo se llama el protagonista de Gantz?", options: ["Kurono","Nishi","Katou","Izumi"], answer:0, explanation: "Kei Kurono es el protagonista." },
  { question: "¿Cómo se llama el protagonista de Re:Zero?", options: ["Subaru","Emilia","Reinhard","Roswaal"], answer:0, explanation: "Subaru es transportado a otro mundo." },
  { question: "¿Qué habilidad tiene Subaru?", options: ["Magic Knight","Return by Death","Time Skip","Summon"], answer:1, explanation: "Subaru regresa a un punto al morir." },
  { question: "¿Cómo se llama el protagonista de Fate/Stay Night?", options: ["Gilgamesh","Archer","Shirou","Kirei"], answer:2, explanation: "Shirou Emiya es el protagonista." },
  { question: "¿Quién es el siervo de Shirou?", options: ["Archer","Saber","Rider","Caster"], answer:1, explanation: "Artoria (Saber) es su servant principal." },
  { question: "¿En qué anime aparece un cuaderno que concede deseos según dibujos?", options: ["Death Note","Future Diary","Bakuman","Hand Shakers"], answer:1, explanation: "Future Diary lo presenta." },
  { question: "¿Quién es la famosa yandere de Future Diary?", options: ["Yuno","Akise","Reisuke","Minene"], answer:0, explanation: "Yuno Gasai es uno de los ejemplos más icónicos." },
  { question: "¿Cómo se llama el protagonista de One Punch Man?", options: ["Genos","Garou","Saitama","Bang"], answer:2, explanation: "Saitama es el héroe calvo más fuerte." },
  { question: "¿Cuál es la habilidad principal de Saitama?", options: ["Energía","Flying Punch","Fuerza absoluta","Regeneración"], answer:2, explanation: "Saitama derrota a cualquier oponente de un golpe." },

  { question: "¿Cómo se llama el protagonista de Fire Force?", options: ["Arthur","Shinra","Obi","Sho"], answer:1, explanation: "Shinra Kusakabe es el protagonista." },
  { question: "¿Cuál es la habilidad de Shinra?", options: ["Control de fuego","Teleportación","Fuego en los pies","Manipulación del aura"], answer:2, explanation: "Puede encender fuego en sus pies para moverse." },
  { question: "¿En qué anime aparece 'El Reino de los Pecados Capitales'?", options: ["Seven Deadly Sins","Overlord","Claymore","Fairy Tail"], answer:0, explanation: "Es el mundo de Nanatsu no Taizai." },
  { question: "¿Quién es el líder de los Siete Pecados Capitales?", options: ["Ban","Escanor","Meliodas","Gowther"], answer:2, explanation: "Meliodas es el capitán." },
  { question: "¿Cómo se llama la protagonista de The Promised Neverland?", options: ["Norman","Emma","Isabella","Ray"], answer:1, explanation: "Emma lidera al grupo de niños." },
  { question: "¿Qué descubren los niños en The Promised Neverland?", options: ["Un tesoro","Demonios","La verdad del orfanato","Un portal"], answer:2, explanation: "Descubren que serán sacrificados." },
  { question: "¿En qué anime aparece la ciudad 'Zuellni'?", options: ["Code Geass","Guilty Crown","Chrome Shelled Regios","Ergo Proxy"], answer:2, explanation: "Chrome Shelled Regios presenta esta ciudad móvil." },
  { question: "¿Cómo se llama el protagonista de Code Geass?", options: ["Suzaku","Jeremiah","Lelouch","Rolo"], answer:2, explanation: "Lelouch Lamperouge es el protagonista." },
  { question: "¿Cuál es el poder de Lelouch?", options: ["Control mental","Invisibilidad","Teletransportación","Fuerza"], answer:0, explanation: "El Geass le permite controlar las acciones de otros." },
  { question: "¿En qué anime aparecen los 'Parasytes'?", options: ["Elfen Lied","Parasyte","Hellsing","Ajin"], answer:1, explanation: "Parasyte trata sobre parásitos alienígenas." },

  { question: "¿Cómo se llama el protagonista de Parasyte?", options: ["Shinichi","Kana","Migi","Urugami"], answer:0, explanation: "Shinichi Izumi es el protagonista." },
  { question: "¿Quién es Migi?", options: ["Un alien","Un perro","Un demonio","Un ghoul"], answer:0, explanation: "Migi es un parásito alienígena que vive en su mano." },
  { question: "¿En qué anime aparece un personaje llamado Alucard?", options: ["Drifters","Hellsing","Castlevania","Berserk"], answer:1, explanation: "Hellsing tiene a Alucard como protagonista." },
  { question: "¿Qué clase de ser es Alucard?", options: ["Mago","Vampiro","Hombre lobo","Mutante"], answer:1, explanation: "Alucard es un poderoso vampiro." },
  { question: "¿En qué anime aparece Guts?", options: ["Claymore","Goblin Slayer","Hellsing","Berserk"], answer:3, explanation: "Guts es el protagonista de Berserk." },
  { question: "¿Qué arma usa principalmente Guts?", options: ["Lanza","Hacha","Espadón","Ballesta"], answer:2, explanation: "Guts usa la espada gigante Dragonslayer." },
  { question: "¿En qué anime los personajes comen 'frutas malditas' que les dan poderes?", options: ["One Piece","Bleach","Toriko","Dr. Stone"], answer:0, explanation: "Las Frutas del Diablo dan poderes en One Piece." },
  { question: "¿Cómo se llama el protagonista de Toradora?", options: ["Ryuuji","Taiga","Kitamura","Haruta"], answer:0, explanation: "Ryuuji es el protagonista masculino." },
  { question: "¿Quién es la 'Tigre Compacta'?", options: ["Ami","Sumire","Taiga","Minori"], answer:2, explanation: "Taiga es conocida como la Tigre Compacta." },
  { question: "¿Cómo se llama la protagonista de K-On!?", options: ["Mio","Azusa","Yui","Ritsu"], answer:2, explanation: "Yui Hirasawa es la protagonista." },

  { question: "¿Qué instrumento toca Yui en K-On!?", options: ["Batería","Guitarra","Bajo","Teclado"], answer:1, explanation: "Yui toca la guitarra eléctrica." },
  { question: "¿En qué anime aparece un detective llamado Conan?", options: ["Psycho Pass","Death Note","Detective Conan","Monster"], answer:2, explanation: "Detective Conan sigue a Conan Edogawa." },
  { question: "¿Cómo se llama el protagonista de Monster?", options: ["Tenma","Johan","Grimmer","Lunge"], answer:0, explanation: "El Dr. Kenzo Tenma es el protagonista." },
  { question: "¿Quién es el antagonista principal de Monster?", options: ["Wolfgang","Johan","Nina","Richard"], answer:1, explanation: "Johan Liebert es el principal antagonista." },
  { question: "¿En qué anime existe la 'Alianza de los Príncipes'? ", options: ["Magi","Akame ga Kill","Bleach","Gantz"], answer:0, explanation: "Aparece en Magi: The Labyrinth of Magic." },
  { question: "¿Cómo se llama el protagonista de Magi?", options: ["Morgiana","Sinbad","Alibaba","Aladdin"], answer:3, explanation: "Aladdin es uno de los protagonistas." },
  { question: "¿En qué anime aparece un chico que revive en un mundo de magia con su smartphone?", options: ["Konosuba","Re:Zero","Isekai Smartphone","Overlord"], answer:2, explanation: "El anime es 'In Another World With My Smartphone'." },
  { question: "¿Cómo se llama el protagonista de Konosuba?", options: ["Aqua","Kazuma","Megumin","Darkness"], answer:1, explanation: "Kazuma es el protagonista." },
  { question: "¿Cuál es la habilidad favorita de Megumin?", options: ["Healing","Explosion","Freeze","Teleport"], answer:1, explanation: "Megumin usa magia Explosión." },
  { question: "¿En qué anime un jugador queda atrapado en un juego como Lord Ainz?", options: ["Log Horizon","SAO","Overlord","Accel World"], answer:2, explanation: "Ainz Ooal Gown es el protagonista de Overlord." }
]; // FIN banco 100

/* ===== LÓGICA DEL EXAMEN: tomar 30 preguntas al azar, mezclar opciones, presentación y corrección ===== */

function shuffleArray(array){
  for(let i = array.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

const startBtn = document.getElementById('startBtn');
const finishBtn = document.getElementById('finishBtn');
const retryBtn = document.getElementById('retryBtn');
const examDiv = document.getElementById('exam');
const resultDiv = document.getElementById('result');

let currentSet = []; // 30 preguntas seleccionadas (ya mezcladas y con opciones barajadas)

startBtn.addEventListener('click', () => {
  // seleccionar 30 preguntas aleatorias del banco de 100
  const temp = shuffleArray(questionBank.slice());
  const pick30 = temp.slice(0, 30);

  // para cada pregunta, clonarla y mezclar opciones y recomputar índice respuesta
  currentSet = pick30.map(q => {
    const clone = JSON.parse(JSON.stringify(q));
    // construir array indexado con opción original y su índice
    const indexed = clone.options.map((opt, idx) => ({ opt, idx }));
    shuffleArray(indexed);
    clone.options = indexed.map(x => x.opt);
    clone.answer = indexed.findIndex(x => x.idx === q.answer);
    return clone;
  });

  // mezclar orden de preguntas también
  shuffleArray(currentSet);

  // renderizar
  examDiv.innerHTML = '';
  currentSet.forEach((q, i) => {
    const qDiv = document.createElement('div');
    qDiv.className = 'question';
    qDiv.dataset.index = i;
    qDiv.innerHTML = `<h3>${i+1}. ${q.question}</h3>`;
    const optsDiv = document.createElement('div');
    optsDiv.className = 'options';
    q.options.forEach((opt, j) => {
      const id = `q${i}_opt${j}`;
      const label = document.createElement('label');
      label.innerHTML = `<input type="radio" name="q${i}" value="${j}"> ${opt}`;
      optsDiv.appendChild(label);
    });
    qDiv.appendChild(optsDiv);
    examDiv.appendChild(qDiv);
  });

  // UI toggles
  startBtn.classList.add('hidden');
  finishBtn.classList.remove('hidden');
  retryBtn.classList.add('hidden');
  examDiv.classList.remove('hidden');
  resultDiv.classList.add('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

finishBtn.addEventListener('click', () => {
  let score = 0;
  // recorrer y evaluar
  currentSet.forEach((q, i) => {
    const qDiv = examDiv.querySelector(`.question[data-index='${i}']`);
    const selected = qDiv.querySelector(`input[name='q${i}']:checked`);
    const userAns = selected ? parseInt(selected.value) : null;

    // remover etiquetas previas si existen
    const h3 = qDiv.querySelector('h3');
    const existingBadge = h3.querySelector('.badge');
    if(existingBadge) existingBadge.remove();

    if(userAns === q.answer){
      score++;
      qDiv.classList.add('correct');
      const span = document.createElement('span');
      span.className = 'badge ok';
      span.textContent = 'Correcto ✓';
      h3.prepend(span);
    } else {
      qDiv.classList.add('incorrect');
      const span = document.createElement('span');
      span.className = 'badge bad';
      span.textContent = 'Incorrecto ✗';
      h3.prepend(span);
      // mostrar respuesta correcta y explicación
      const explained = document.createElement('div');
      explained.className = 'explain';
      explained.innerHTML = `<div><strong>Respuesta correcta:</strong> ${q.options[q.answer]}</div>
                            <div style="margin-top:8px;">${q.explanation || 'Explicación no disponible.'}</div>`;
      // prevenir duplicados
      if(!qDiv.querySelector('.explain')) qDiv.appendChild(explained);
    }
  });

  // resultado final
  resultDiv.classList.remove('hidden');
  resultDiv.innerHTML = `<h3>Resultado final</h3>
                         <p>Puntuación: <strong>${score} / ${currentSet.length}</strong></p>
                         <p class="small">Las preguntas correctas se marcaron en verde. Las incorrectas en rojo incluyen la respuesta correcta y una explicación.</p>`;
  finishBtn.classList.add('hidden');
  retryBtn.classList.remove('hidden');
  resultDiv.scrollIntoView({behavior:'smooth'});
});

retryBtn.addEventListener('click', () => {
  examDiv.innerHTML = '';
  resultDiv.classList.add('hidden');
  retryBtn.classList.add('hidden');
  startBtn.classList.remove('hidden');
  finishBtn.classList.add('hidden');
  // forzar garbage collect de currentSet
  currentSet = [];
  window.scrollTo({ top: 0, behavior: 'smooth' });
});
</script>
</body>
</html>